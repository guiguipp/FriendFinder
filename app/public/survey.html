<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Survey</title>

  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <script src="https://code.jquery.com/jquery.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
</head>
<body>

  <div class="container">
    
    <div class="jumbotron">
      <h1 class="text-center"><span class="fa fa-fire"></span> Hot Restaurant</h1>
      <hr>
      <h2 class="text-center">Voting both</h2>
      <br>

      <div class="text-center">
        <a href="../survey"><button class="btn btn-lg btn-primary"><span class="fa fa-list-alt"></span> Take Survey</button></a>
        <a href="../candidates"><button class="btn btn-lg btn-danger"><span class="fa fa-credit-card"></span> See candidates</button></a>
      </div>

    </div>

    <div class="container">
        <h2> For each of these statement, mark if you "Strongly Agree", "Agree", "Neither Agree nor Disagree", "Disagree", "Strongly Disagree"</h2>
        <div class="panel-body">
            <form>
            <div id= "aPlaceForSurvey">
                <input type="submit" name="g" value="Submit" id="g">
            </div>
            </form>

        </div>
    </div>
    
    <footer class="footer">
      <div class="container">
        <p><a href="/api/friends">API Voters</a> | <a href="/api/governors">API Governors</a> | <a href="https://github.com/guiguipp/FriendFinder">GitHub Repo</a></p>
      </div>
    </footer>

  </div>


</body>
<script>
$( document ).ready(function() {
console.log( "ready!" );
function getAPIdata() {

  var currentURL = window.location.origin;

  // The AJAX function uses the URL of our API to GET the data associated with it (initially set to localhost)
  $.ajax({ url: currentURL + "/api/governors", method: "GET" })
    .then(function(dataFromAPI) {
    console.log("URL: " + currentURL + "/api/governors");

    function lineBreak(jsText){
        return jsText.replace(/["\n"]/g,"<br>")
    }
    const d = dataFromAPI.governors
    console.log(d)
    d.forEach((e,i) => {
        let surveyDiv = $("<div>");
            surveyDiv.addClass("question");
            surveyDiv.attr("id", e.id);
            $("#aPlaceForSurvey").prepend(surveyDiv);
            
            // Then display the remaining fields in the HTML (Section Name, Date, URL)
            let stance1 = e.stances[0].issue;
            let question1= lineBreak(e.stances[0].stance);
            let buttonSet = 
            `
            <div class="btn-group btn-group-toggle" data-toggle="buttons">
            <label class="btn btn-secondary">
                <input type="radio" name="${e.id}" value="2" autocomplete="off"> Strongly Agree
            </label>
            <label class="btn btn-secondary">
                <input type="radio" name="${e.id}" value="1" autocomplete="off"> Agree
            </label>
            <label class="btn btn-secondary">
                <input type="radio" name="${e.id}" value="0" autocomplete="off"> Neither agree nor disagree
            </label>
            <label class="btn btn-secondary">
                <input type="radio" name="${e.id}" value="-1" autocomplete="off"> Disagree
            </label>
            <label class="btn btn-secondary">
                <input type="radio" name="${e.id}" value="-2" autocomplete="off"> Strongly Disagree
            </label>
            </div>`
            $("#" + e.id).append(`<h3> ${stance1} </h3> <br> <p> ${question1}\n${buttonSet}`);
        });

      })}
    
getAPIdata();

$( "form" ).submit(function( event ) {
  var result = ( $( this ).serializeArray() );
  event.preventDefault();
  console.log("results: ", result);
  let values = result.filter(result => result.name === "murphy");
  console.log("Murphy: ", values);
  console.log("Murphy values: ", values[0].value);
  console.log(typeof values[0].value);
  console.log(parseInt(values[0].value));

  
});


});
</script>
</html>
