<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Survey</title>

  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <script src="https://code.jquery.com/jquery.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
</head>
<body>

  <div class="container">
    
    <div class="jumbotron">
      <h1 class="text-center"><span class="fa fa-fire"></span> Voting both</h1>
      <hr>
      

      <div class="text-center">
        <a href="../survey"><button class="btn btn-lg btn-primary"><span class="fa fa-list-alt"></span> Take Survey</button></a>
        <a href="../candidates"><button class="btn btn-lg btn-danger"><span class="fa fa-credit-card"></span> See candidates</button></a>
      </div>

    </div>

    <div class="container">
        <h2> For each of these statement, mark if you "Strongly Agree", "Agree", "Neither Agree nor Disagree", "Disagree", "Strongly Disagree"</h2>
        <div class="panel-body">
            <form>
            <div id= "aPlaceForSurvey">
                <input type="submit" name="g" value="Submit" id="g"><br>
                <button type="button" class="btn btn-danger" id="toggle_dfl">Show/Hide DFL</button>
                <button type="button" class="btn btn-primary" id="toggle_rep">Show/Hide Republicans</button>
                
            </div>
            </form>

        </div>
    </div>
    
    <footer class="footer">
      <div class="container">
        <p><a href="/api/friends">API Voters</a> | <a href="/api/governors">API Governors</a> | <a href="https://github.com/guiguipp/FriendFinder">GitHub Repo</a></p>
      </div>
    </footer>

  </div>


</body>
<script>
$( document ).ready(function() {
console.log( "grinding human meat..." );
function getAPIdata() {

  var currentURL = window.location.origin;

  // The AJAX function uses the URL of our API to GET the data associated with it (initially set to localhost)
  $.ajax({ url: currentURL + "/api/governors", method: "GET" })
    .then(function(dataFromAPI) {
    console.log("URL: " + currentURL + "/api/governors");
    const d = dataFromAPI.governors
    console.log(d)
    for (let t = 0; t < 4; t++) {
        d.forEach((e,i) => {
        let surveyDiv = $("<div>");
            surveyDiv.addClass(`${e.party}`);
            surveyDiv.attr("id", e.id);
            $("#aPlaceForSurvey").prepend(surveyDiv);
            
            let stance = e.stances[t].issue;
            let question = lineBreak(e.stances[t].stance);
            let option1 = {num : 2, string : "Strongly Agree"};
            let option2 = {num : 1, string : "Agree"};
            let option3 = {num : 0, string : "Neither Agree nor Disagree"};
            let option4 = {num : -1, string : "Disagree"};
            let option5 = {num : -2, string : "Strongly Disagree"};
            let buttonSet = 
            `
            <div class="btn-group btn-group-toggle" data-toggle="buttons">
            <label class="btn btn-secondary">
                <input type="radio" name="${e.id}${t}" value="${option1.num}" autocomplete="off">${option1.string}
            </label>
            <label class="btn btn-secondary">
                <input type="radio" name="${e.id}${t}" value="${option2.num}" autocomplete="off">${option2.string}
            </label>
            <label class="btn btn-secondary">
                <input type="radio" name="${e.id}${t}" value="${option3.num}" autocomplete="off">${option3.string}
            </label>
            <label class="btn btn-secondary">
                <input type="radio" name="${e.id}${t}" value="${option4.num}" autocomplete="off">${option4.string}
            </label>
            <label class="btn btn-secondary">
                <input type="radio" name="${e.id}${t}" value="${option5.num}" autocomplete="off">${option5.string}
            </label>
            </div>`
            $("#" + e.id).append(`<h3> ${stance} </h3> <br> <p> ${question}\n${buttonSet}`);
        });
        }


      })}
$("#toggle_dfl").click(function(){
    $(".DFL").toggle();
});    
$("#toggle_rep").click(function(){
    $(".Republican").toggle();
});    
getAPIdata();

$( "form" ).submit(function( event ) {
var allValues = ( $( this ).serializeArray() );
event.preventDefault();
//   console.log("results: ", allValues);

// creating arrays where value matches the name of candidate (strips the number from the id)
// problem: this is not dynamic. If create a new candidate, has to be able to run this
// can surely be done by a for loop (but then should be using data from API)
let murphyValues = allValues.filter(allValues => allValues.name.replace(/([\d])+/g,"") === "murphy");
let walzValues = allValues.filter(allValues => allValues.name.replace(/([\d])+/g,"") === "walz");
let johnsonValues = allValues.filter(allValues => allValues.name.replace(/([\d])+/g,"") === "johnson");
let parrishValues = allValues.filter(allValues => allValues.name.replace(/([\d])+/g,"") === "parrish");
let stephensValues = allValues.filter(allValues => allValues.name.replace(/([\d])+/g,"") === "stephens");
// console.log("Murphy: ", murphyValues);
// console.log("Walz: ", walzValues);
// console.log("Johnson: ", johnsonValues);
// console.log("Parrish: ", parrishValues);
// console.log("Stephens: ", stephensValues);
  
arrayToNum(murphyValues);
console.log("Murphy avg: ", arrayToNum(murphyValues));
arrayToNum(walzValues);
console.log("Walz avg: ", arrayToNum(walzValues));
arrayToNum(parrishValues);
console.log("Parrish avg: ", arrayToNum(parrishValues));
arrayToNum(johnsonValues);
console.log("Johnson avg: ", arrayToNum(johnsonValues));
arrayToNum(stephensValues);
console.log("Stephens avg: ", arrayToNum(stephensValues));

});
// finds the average of any array of numbers
const arrayAvg = arr => arr.reduce((a,b) => a + b, 0) / arr.length;
// converts "value" from string to number, then returns average 
function arrayToNum(array){
    let arrayNums = [];
    for (let i = 0; i < array.length; i++) {
      arrayNums.push(parseInt(array[i].value));
    //   console.log("arrayNums: ", arrayNums);
    }
      let average = arrayAvg(arrayNums);
    //   console.log("arrayAvg(arrayNums)", arrayAvg(arrayNums))
      return average;
    }    
  
// makes the text less compact by replacing all js \n by html <br>
function lineBreak(jsText){
    return jsText.replace(/["\n"]/g,"<br>")
}

});
</script>
</html>
